---
title: >
  æ–°ã—ã„Polars Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç´¹ä»‹
subtitle: "2025-12-06 Japan.R 2025<br/>@eitsupi"
format:
  revealjs:
    theme: night
    width: 1280
    height: 720
    slide-number: true
    chalkboard: false
    preview-links: auto
    footer: "#Japan.R 2025"
    # embed-resources: true
    reference-location: document
execute:
  cache: true
  echo: true
lang: ja
---

# ã¯ã˜ã‚ã«

## è‡ªå·±ç´¹ä»‹

:::: {.columns}

::: {.column width="25%"}

![](../image/eitsupi.jpg){fig-align="center" width="300" height="300"}

:::

::: {.column width="75%"}

- [@eitsupi](https://github.com/eitsupi)
- æœ¬æ¥­ï¼šæ‰‹æ–™ç†ã‚µãƒ–ã‚¹ã‚¯ ã¤ãã‚ŠãŠã.jp ã®  
  ã€€ã€€ã€€ãƒ‡ãƒ¼ã‚¿åŸºç›¤å‘¨ã‚Šï¼ˆdbtï¼‰
- å‰¯æ¥­ï¼šColumnarç¤¾ã§ADBCå‘¨ã‚Šã®ãŠæ‰‹ä¼ã„
- ExcelãŒå«Œã«ãªã‚ŠRã‚’ä½¿ã„å§‹ã‚ã¦6å¹´
  - [Rockerãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ (Shell, R, Docker)](https://rocker-project.org/)
  - [Polars Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (R, Rust)](https://pola-rs.github.io/r-polars/)
  - [PRQL (Rust, R, Python)](https://prql-lang.org/)

:::

::::

# å‰å›ã¾ã§ã®ã‚ã‚‰ã™ã˜

---

ã“ã‚Œã¾ã§dplyrãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è©±ã‚’è‰²ã€…ã—ãŸã‚Š

Polars Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç´¹ä»‹ã‚‚ã—ã¦ã„ã¾ã—ãŸã€‚

---

## æœ¬æ—¥è©±ã™ã“ã¨

::: {.incremental}

- Rã§Polarsã‚’ä½¿ã£ã¦ã¿ã‚‹
  - Python Polarsé¢¨æ§‹æ–‡
  - dplyrãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- æŠ€è¡“çš„ãªè©±
  - nanoarrowã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
  - mirai/reticulateçµ±åˆ
  - S7

:::

# Polarsã«ã¤ã„ã¦

---

## Polars

::: {.incremental}

- ã€Œæœ€é€Ÿã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸€ã¤ã€
- Rustè£½
- Apache Arrowã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
- Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒäººæ°—
  - ä¸­èº«ã®Rustãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚å…¬å¼
  - éå…¬å¼ï¼šNodo.jsã€Rã€Ruby

:::

---

## ï¼ˆã“ã“ã«è‰¯ã„æ„Ÿã˜ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœãŒå…¥ã‚‹ï¼‰

. . .

```{.default .center}
#> # A tibble: 7 Ã— 6
#>   expression             min   median `itr/sec` mem_alloc `gc/sec`
#>   <bch:expr>        <bch:tm> <bch:tm>     <dbl> <bch:byt>    <dbl>
#> 1 acero_dplyr        149.7ms  156.1ms      6.25   41.83MB     0
#> 2 duckdb_dbplyr      109.4ms  113.7ms      8.35   24.18MB     2.09
#> 3 duckdb_duckplyr     62.8ms   69.1ms     14.4     3.71MB     0
#> 4 duckdb              59.6ms   61.5ms     14.9      4.9KB     0
#> 5 sedonadb            56.8ms   73.1ms     13.6      6.7MB     0
#> 6 polars_tidypolars   62.4ms   67.2ms     13.5    13.15MB     2.26
#> 7 polars                50ms   53.2ms     18.8    99.51KB     0
```

<div style="text-align: right;">
[2025-12-01ã«å…¬é–‹ã—ãŸè¨˜äº‹ã‚ˆã‚Š](https://zenn.dev/eitsupi/articles/r-polars-2025)
</div>

# Rã§Polarsã‚’ä½¿ã£ã¦ã¿ã‚‹

---

:::: {.columns}

::: {.column width="50%"}

### Python

```python
import polars as pl
import polars.selectors as cs

pl.DataFrame(
    {
        "x": [1, 2, 3],
        "y": ["a", "b", "c"],
    }
).select(cs.by_name("x"))
```

:::

::: {.column width="50%"}

### R

```r
library(polars)

pl$DataFrame(
  x = c(1, 2, 3),
  y = c("a", "b", "c"),
)$select(cs$by_name("x"))
```

:::

::::

# ä½•ãã®æ§‹æ–‡

## reticulateçµŒç”±ã§Python Polars

```r

```

## Polarsæ§‹æ–‡

- Python Polarsã‚’å‚è€ƒã«Rust Polarsã‚’æ›¸ã“ã†ã¨ã¨ã™ã‚‹ã¨ğŸ˜‡

# ä½™è«‡ï¼š ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

## MSRVå•é¡Œ

- R-multiverseã‚’ä½¿ã„ã¾ã—ã‚‡ã†

# dplyrãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

## tidypolars

- dplyrãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- å¤šæ•°ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é–¢æ•°ã‚’ã€dplyrå‹•è©å†…ã§ä½¿ç”¨å¯èƒ½ã«ã™ã‚‹
  - å‹•è©å†…ã®é–¢æ•°ã‚’æ¤œå‡ºã—ã€polarsã®å¼ã«ç½®ãæ›ãˆã‚‹ï¼ˆarrowãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«é¡ä¼¼ï¼‰

# æŠ€è¡“çš„ãªè©±

## miraiçµ±åˆ

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«

## reticulateçµ±åˆ

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«`reticulate::r_to_py()`ã®
S3ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
â†’

## S7æ¡ç”¨

ç’°å¢ƒå‹ã«S3ã‚¯ãƒ©ã‚¹å±æ€§ã‚’ä¸ãˆã¦ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç”Ÿã‚„ã—ãŸã‚Šã—ãŸã‚‚ã®
ï¼ˆR6ã‚¯ãƒ©ã‚¹ã«é¡ä¼¼ï¼‰

```r
```

- åˆ©ç‚¹
  - å˜ç´”ã€ä¾å­˜é–¢ä¿‚ãªã—
- æ¬ ç‚¹
  - `is.environment()`ãŒ`TRUE`ã«ãªã‚‹

---

```{r}
#| error: true
plot(polars::as_polars_df(mtcars))
```

â†‘ã®ã‚ˆã†ã«è¬ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€`plot()`é–¢æ•°ã‚’ä½¿ãˆãªã„ã€‚

. . .

- é–¢æ•°å†…ã§`is.environment()`ã«ã‚ˆã‚‹åˆ¤å®šãŒè¡Œã‚ã‚Œã¦ãŠã‚Šã€`as.data.frame()`ã¾ã§åˆ°é”ã§ããªã„ã€‚
  - arrowãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¯ãƒ©ã‚¹ã§ã‚‚åŒã˜ï¼ˆR6ãªã®ã§ï¼‰ã€‚

---

## å¤šé‡ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒ

::: {.incremental}

- æ¼”ç®—å­

  ```r
  s <- polars::as_polars_series(1L)
  e <- polars::as_polars_expr(1L)

  s + 1 # 2 (Series)
  e + 1 # 2 (Expr)

  s + e # ã‚¨ãƒ©ãƒ¼
  e + s # ã‚¨ãƒ©ãƒ¼
  ```

- è¤‡é›‘ãªé–¢æ•°

  ```r
  df <- polars::as_polars_df(mtcars)

  df[, 1]
  df[1]
  df[, "mpg"]
  df["mpg"]
  ```

:::
